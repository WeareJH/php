version: 2
jobs:
    # Latest build
    build:
        machine: true
        steps:
            - checkout
            - run: ./build.sh 7.2 --no-cache
            - run: ./publish.sh 7.2

    build-5.6:
        machine: true
        steps:
            - checkout
            - run: ./build.sh 5.6 --no-cache
            - run: ./publish.sh 5.6

    build-7.0:
        machine: true
        steps:
            - checkout
            - run: ./build.sh 7.0 --no-cache
            - run: ./publish.sh 7.0

    build-7.1:
        machine: true
        steps:
            - checkout
            - run: ./build.sh 7.1 --no-cache
            - run: ./publish.sh 7.1

workflows:
    version: 2

    build_versions:
        jobs:
            - build:
                filters:
                    branches:
                        only:
                            - master
            - build-5.6:
                filters:
                    branches:
                        only:
                            - master

            - build-7.0:
                filters:
                    branches:
                        only:
                            - master

            - build-7.1:
                filters:
                    branches:
                        only:
                            - master

    weekly_builds:
        triggers:
            - schedule:
                cron: "0 10 * * 1"
                filters:
                    branches:
                        only:
                            - master
        jobs:
            - build
            - build-5.6
            - build-7.0
            - build-7.1
